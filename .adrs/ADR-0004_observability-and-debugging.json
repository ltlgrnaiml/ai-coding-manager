{
  "schema_type": "adr",
  "id": "ADR-0004",
  "title": "Observability & Debugging First",
  "status": "active",
  "date": "2025-12-31",
  "review_date": "2026-06-30",
  "author": "Mycahya Eggleston",
  "scope": "core",
  "origin": "Extracted from engineering-tools ADR-0037",
  "context": {
    "description": "For a solo developer, debugging is the largest time sink. Without comprehensive observability, issues require manual reproduction and guesswork.",
    "problem": "Need visibility into every operation - structured logging, tracing, state snapshots - to enable rapid root-cause analysis."
  },
  "decision": {
    "summary": "Every operation MUST be traceable. Use structured JSON logging, request ID propagation, and Phoenix for LLM call tracing.",
    "logging_standard": {
      "library": "structlog",
      "format": "JSON lines",
      "required_fields": ["timestamp", "level", "event", "request_id"],
      "levels": {
        "DEBUG": "Detailed diagnostic (disabled in production)",
        "INFO": "Normal operation events",
        "WARNING": "Unexpected but handled",
        "ERROR": "Failures requiring attention"
      }
    },
    "llm_observability": {
      "tool": "Phoenix (Arize)",
      "features": [
        "OpenTelemetry-based tracing",
        "LangChain instrumentation",
        "OpenAI SDK instrumentation (works with xAI)",
        "Cost tracking per call"
      ],
      "ui": "http://localhost:6006 when Phoenix server running"
    },
    "request_tracing": {
      "header": "X-Request-ID",
      "generation": "UUID4 if not provided",
      "propagation": "Included in all downstream calls"
    }
  },
  "consequences": {
    "positive": [
      "Rapid root-cause analysis (filter logs by request_id)",
      "LLM calls fully auditable with costs",
      "Structured logs enable querying and aggregation",
      "Solo-dev can 'replay' issues without reproduction"
    ],
    "negative": [
      "Increased log volume",
      "Phoenix adds ~100MB memory overhead"
    ]
  },
  "guardrails": [
    {"id": "structured-logging", "rule": "All log messages MUST be structured JSON via structlog"},
    {"id": "request-id-required", "rule": "All API requests MUST have request_id propagated"},
    {"id": "llm-tracing", "rule": "All LLM calls MUST be traced via Phoenix/OpenTelemetry"}
  ],
  "tags": ["observability", "logging", "debugging", "tracing", "phoenix"]
}
